package controller;

import java.util.List;

import dao.CharacterDAO;
import dao.InventoryDAO;
import vo.CharacterVO;
import vo.InventoryVO;

public class GameController {
	private GameController () {}
	private static GameController instance;
	public static GameController getController() {
		if(instance == null) {
			instance = new GameController();
		}
		return instance;
	}
	
	public CharacterVO getCharacterInfo(CharacterVO vo) throws Exception {
		CharacterDAO dao = CharacterDAO.getCharacterDAO();
		return dao.showCharacterInfo(vo);
	}
	
	public List<InventoryVO> showInventory(CharacterVO vo) throws Exception {
		InventoryDAO invenDao = InventoryDAO.getInvetoryDAO();
		List<InventoryVO> list = invenDao.showInventory(new InventoryVO(null, vo.getCharIdx(), 0));
		return list;
	}
	
	public boolean useItem(InventoryVO vo) throws Exception {
		InventoryDAO invenDao = InventoryDAO.getInvetoryDAO();
		boolean result = false;
		
		if(vo.getDitin() == "3") {
			invenDao.mountingWeapon(vo);
			invenDao.useItemDelete(vo);
		} else if(vo.getDitin() == "4") {
			invenDao.mountingArmor(vo);
			invenDao.useItemDelete(vo);
		} else if(vo.getDitin() == "1"){
			result = invenDao.useItemChangeUser(vo);
			if(vo.getItemCo() == 1) {
				result = invenDao.useItemDelete(vo);
			} else {
				result = invenDao.useItemMinus(vo);
			}
		} else {
			result = false;
		}
		
		return result;
	}
	
	public boolean unEquippingWeapon(CharacterVO vo) throws Exception {
		InventoryDAO inveDao = InventoryDAO.getInvetoryDAO();
		CharacterDAO charDao = CharacterDAO.getCharacterDAO();

		if(vo.getCharWeapon().equals("없음")) {
			return false;
		}
		boolean insertItem = inveDao.insertItem(new InventoryVO(vo.getCharWeapon(), vo.getCharIdx(), 1));
		boolean unEquip = charDao.unEquippingWeapon(vo);

		if(insertItem && unEquip) {
			return true;
		}
		return false;
	}
	
	public boolean unEquippingArmor(CharacterVO vo) throws Exception {
		InventoryDAO inveDao = InventoryDAO.getInvetoryDAO();
		CharacterDAO charDao = CharacterDAO.getCharacterDAO();
		if(vo.getCharArmor().equals("없음")) {
			return false;
		}
		boolean insertItem = inveDao.insertItem(new InventoryVO(vo.getCharArmor(), vo.getCharIdx(), 1));
		boolean unEquip = charDao.unEquippingArmor(vo);
		
		if(insertItem && unEquip) {
			return true;
		}
		return false;
	}
	
	
}
